#!/bin/bash

# unlink all specified config files
clean_configs() {
  unlink_file ~/.gitconfig
  unlink_file ~/.ssh
  unlink_file ~/.heroku
}

# set all configs for the environment specified by $1 
# e.g. set_configs "home" sets links all config files to ther "home" version
set_configs() {
  link_file ~/dotfiles/git/gitconfig-$1 ~/.gitconfig
  link_file ~/dotfiles/ssh/ssh-$1 ~/.ssh
  link_file ~/dotfiles/heroku/heroku-$1 ~/.heroku
}

# kill the ssh agent
kill_sshagent() {
  kill $(ps ux | awk '/ssh-agent/ && !/awk/ {print $2}') > /dev/null 2>&1
}

# remove the link $1
unlink_file() {
  rm $1
}

# link $1 to $2
link_file() {
  ln -nfs $1 $2
}

case "$1" in
  work)
    echo "You gotta do, what you gotta do"
    kill_sshagent
    clean_configs
    set_configs "work"
    ;;
  home)
    echo "So, home it is then."
    kill_sshagent
    clean_configs
    set_configs "home"
    ;;
  *)
    echo "\$go2 home or \$go2 work"
    exit
    ;;
esac

